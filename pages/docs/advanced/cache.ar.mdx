import { Callout } from 'nextra-theme-docs'

机翻
# Cache

<Callout>
  قم بالترقية إلى أحدث إصدار (≥ 1.0.0) لاستخدام هذه الميزة.
</Callout>

<Callout emoji="⚠️">
 في معظم الحالات، يجب ألا تكتب مباشرة إلى ذاكرة التخزين المؤقت، مما قد يتسبب في سلوكيات غير محددة ل SWR. إذا كنت بحاجة إلى تبديل مفتاح يدويا، فيرجى التفكير في استخدام واجهات برمجة تطبيقات SWR. 
 انظر أيضا: [طفرة](/docs/mutation)، [إعادة تعيين ذاكرة التخزين المؤقت بين حالات الاختبار](#reset-cache-between-test-cases).
</Callout>

بشكل افتراضي، يستخدم SWR ذاكرة تخزين مؤقت عالمية لتخزين البيانات ومشاركتها عبر جميع المكونات. ولكن يمكنك أيضا تخصيص هذا السلوك باستخدام خيار `provider` ل `SWRConfig`. رقم 
 
يهدف مزودو ذاكرة التخزين المؤقت إلى تمكين SWR من خلال المزيد من المخازن المخصصة.

## Cache Provider [#cache-provider]

مزود ذاكرة التخزين المؤقت هو كائن يشبه الخريطة يتطابق مع تعريف TypeScript التالي (والذي يمكن استيراده من `swr`):

```typescript
interface Cache<Data> {
  get(key: string): Data | undefined
  set(key: string, value: Data): void
  delete(key: string): void
  keys(): IterableIterator<string>
}
```

على سبيل المثال، يمكن استخدام مثيل [JavaScript Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map) مباشرة كمزود ذاكرة التخزين المؤقت ل SWR. 
 
## إنشاء موفر ذاكرة التخزين المؤقت [#create-cache-provider] 
 
يتلقى خيار `provider22` ل `SWRConfig` وظيفة ترجع [مزود ذاكرة التخزين المؤقت](#cache-provider). سيتم بعد ذلك استخدام المزود من قبل جميع خطافات SWR داخل حدود `SWRConfig`. على سبيل المثال:

```jsx
import useSWR, { SWRConfig } from 'swr'

function App() {
  return (
    <SWRConfig value={{ provider: () => new Map() }}>
      <Page/>
    </SWRConfig>
  )
}
```

ستقرأ جميع خطافات SWR داخل `<Page/>` وتكتب من مثيل الخريطة هذا. يمكنك أيضا استخدام تطبيقات مزود ذاكرة التخزين المؤقت الأخرى أيضا لحالة الاستخدام المحددة الخاصة بك.

<Callout>
في المثال أعلاه، عند إعادة تركيب المكون `<App/>`، سيتم أيضا إعادة إنشاء المزود. يجب وضع مزودي ذاكرة التخزين المؤقت أعلى في شجرة المكونات، أو خارج العرض.
</Callout>

import { Cache } from 'components/diagrams/cache'

<div className="my-8">
  <Cache/>
</div>

عند التداخل، ستستخدم خطافات SWR مزود ذاكرة التخزين المؤقت للمستوى الأعلى. إذا لم يكن هناك مزود ذاكرة تخزين مؤقت من المستوى الأعلى، فإنه يتراجع إلى مزود ذاكرة التخزين المؤقت الافتراضي، وهو `Map` فارغ.

<Callout emoji="⚠️">
   إذا تم استخدام مزود ذاكرة التخزين المؤقت، فإن `mutate` العالمي **لا** سيعمل على خطافات SWR تحت حدود `<SWRConfig>` هذه. يرجى استخدام [this](#access-current-cache-provider) بدلا من ذلك.
</Callout>

## الوصول إلى مزود ذاكرة التخزين المؤقت الحالي [#access-current-cache-provider] 

عندما تكون داخل مكون React، تحتاج إلى استخدام خطاف [`useSWRConfig`](/docs/global-configuration#access-to-global-configurations) للوصول إلى مزود ذاكرة التخزين المؤقت الحالي بالإضافة إلى التكوينات الأخرى بما في ذلك `mutate`:

```jsx
import { useSWRConfig } from 'swr'

function Avatar() {
  const { cache, mutate, ...extraConfig } = useSWRConfig()
  // ...
}
```

إذا لم يكن تحت أي  `<SWRConfig>`، فسيعيد التكوينات الافتراضية.

## تجريبي: تمديد مزود ذاكرة التخزين المؤقت [#experimental-extend-cache-provider]

<Callout emoji="🧪">
   هذه ميزة تجريبية، قد يتغير السلوك في الترقيات المستقبلية.
</Callout>

عندما تكون مكونات `<SWRConfig>` متعددة متداخلة، يمكن تمديد مزود ذاكرة التخزين المؤقت. رقم 

الوسيطة الأولى لوظيفة `provider` هي مزود ذاكرة التخزين المؤقت للمستوى الأعلى `<SWRConfig>` (أو ذاكرة التخزين المؤقت الافتراضية إذا لم يكن هناك الأصل  `<SWRConfig>`)، يمكنك استخدامه لتوسيع مزود ذاكرة التخزين المؤقت:

```jsx
<SWRConfig value={{ provider: (cache) => newCache }}>
  ...
</SWRConfig>
```

## أمثلة [#أمثلة] 

### LocalStorage Based Persent Cache [#localstorage-based-persistent-cache] 

قد ترغب في مزامنة ذاكرة التخزين المؤقت الخاصة بك مع `localStorage`. إليك مثال على التنفيذ:

```jsx
function localStorageProvider() {
  // When initializing, we restore the data from `localStorage` into a map.
  const map = new Map(JSON.parse(localStorage.getItem('app-cache') || '[]'))

  // Before unloading the app, we write back all the data into `localStorage`.
  window.addEventListener('beforeunload', () => {
    const appCache = JSON.stringify(Array.from(map.entries()))
    localStorage.setItem('app-cache', appCache)
  })

  // We still use the map for write & read for performance.
  return map
}
```

ثم استخدمه كمزود:

```jsx
<SWRConfig value={{ provider: localStorageProvider }}>
  <App/>
</SWRConfig>
```

<Callout>
  كتحسين، يمكنك أيضا استخدام ذاكرة التخزين المؤقت للذاكرة كمخزن مؤقت، والكتابة إلى `localStorage` بشكل دوري. يمكنك أيضا تنفيذ ذاكرة تخزين مؤقت متعددة الطبقات مماثلة باستخدام IndexedDB أو WebSQL.
</Callout>

### إعادة تعيين ذاكرة التخزين المؤقت بين حالات الاختبار [#reset-cache-between-test-cases] 

عند اختبار التطبيق الخاص بك، قد ترغب في إعادة تعيين ذاكرة التخزين المؤقت SWR بين حالات الاختبار. يمكنك ببساطة لف طلبك بمزود ذاكرة تخزين مؤقت فارغ. إليك مثال مع Jest:

```jsx
describe('test suite', async () => {
  it('test case', async () => {
    render(
      <SWRConfig value={{ provider: () => new Map() }}>
        <App/>
      </SWRConfig>
    )
  })
})
```

### تعديل بيانات ذاكرة التخزين المؤقت [#modify-the-cache-data]

<Callout emoji="🚨" type="error">
يجب ألا تكتب إلى ذاكرة التخزين المؤقت مباشرة، فقد يتسبب ذلك في سلوك غير محدد.
</Callout>

يمكنك استخدام [`mutate`](/docs/mutation) لتعديل ذاكرة التخزين المؤقت. على سبيل المثال، يمكنك مسح جميع بيانات ذاكرة التخزين المؤقت مثل ما يلي.

```jsx
const { mutate } = useSWRConfig()

mutate(
  key => true, // which cache keys are updated
  undefined, // update cache data to `undefined`
  { revalidate: false } // do not revalidate
)
```

يمكن العثور على مزيد من المعلومات [هنا](/docs/arguments#multiple-arguments).
