import { Callout } from 'nextra-theme-docs'

ๆบ็ฟป
# Cache

<Callout>
  ูู ุจุงูุชุฑููุฉ ุฅูู ุฃุญุฏุซ ุฅุตุฏุงุฑ (โฅ 1.0.0) ูุงุณุชุฎุฏุงู ูุฐู ุงูููุฒุฉ.
</Callout>

<Callout emoji="โ๏ธ">
 ูู ูุนุธู ุงูุญุงูุงุชุ ูุฌุจ ุฃูุง ุชูุชุจ ูุจุงุดุฑุฉ ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุชุ ููุง ูุฏ ูุชุณุจุจ ูู ุณููููุงุช ุบูุฑ ูุญุฏุฏุฉ ู SWR. ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชุจุฏูู ููุชุงุญ ูุฏููุงุ ููุฑุฌู ุงูุชูููุฑ ูู ุงุณุชุฎุฏุงู ูุงุฌูุงุช ุจุฑูุฌุฉ ุชุทุจููุงุช SWR. 
 ุงูุธุฑ ุฃูุถุง: [ุทูุฑุฉ](/docs/mutation)ุ [ุฅุนุงุฏุฉ ุชุนููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ](#reset-cache-between-test-cases).
</Callout>

ุจุดูู ุงูุชุฑุงุถูุ ูุณุชุฎุฏู SWR ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ุนุงูููุฉ ูุชุฎุฒูู ุงูุจูุงูุงุช ููุดุงุฑูุชูุง ุนุจุฑ ุฌููุน ุงูููููุงุช. ูููู ููููู ุฃูุถุง ุชุฎุตูุต ูุฐุง ุงูุณููู ุจุงุณุชุฎุฏุงู ุฎูุงุฑ `provider` ู `SWRConfig`. ุฑูู 
 
ููุฏู ูุฒูุฏู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฅูู ุชูููู SWR ูู ุฎูุงู ุงููุฒูุฏ ูู ุงููุฎุงุฒู ุงููุฎุตุตุฉ.

## Cache Provider [#cache-provider]

ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ูุงุฆู ูุดุจู ุงูุฎุฑูุทุฉ ูุชุทุงุจู ูุน ุชุนุฑูู TypeScript ุงูุชุงูู (ูุงูุฐู ูููู ุงุณุชูุฑุงุฏู ูู `swr`):

```typescript
interface Cache<Data> {
  get(key: string): Data | undefined
  set(key: string, value: Data): void
  delete(key: string): void
  keys(): IterableIterator<string>
}
```

ุนูู ุณุจูู ุงููุซุงูุ ูููู ุงุณุชุฎุฏุงู ูุซูู [JavaScript Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map) ูุจุงุดุฑุฉ ููุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ู SWR. 
 
## ุฅูุดุงุก ูููุฑ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช [#create-cache-provider] 
 
ูุชููู ุฎูุงุฑ `provider22` ู `SWRConfig` ูุธููุฉ ุชุฑุฌุน [ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช](#cache-provider). ุณูุชู ุจุนุฏ ุฐูู ุงุณุชุฎุฏุงู ุงููุฒูุฏ ูู ูุจู ุฌููุน ุฎุทุงูุงุช SWR ุฏุงุฎู ุญุฏูุฏ `SWRConfig`. ุนูู ุณุจูู ุงููุซุงู:

```jsx
import useSWR, { SWRConfig } from 'swr'

function App() {
  return (
    <SWRConfig value={{ provider: () => new Map() }}>
      <Page/>
    </SWRConfig>
  )
}
```

ุณุชูุฑุฃ ุฌููุน ุฎุทุงูุงุช SWR ุฏุงุฎู `<Page/>` ูุชูุชุจ ูู ูุซูู ุงูุฎุฑูุทุฉ ูุฐุง. ููููู ุฃูุถุง ุงุณุชุฎุฏุงู ุชุทุจููุงุช ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุฃุฎุฑู ุฃูุถุง ูุญุงูุฉ ุงูุงุณุชุฎุฏุงู ุงููุญุฏุฏุฉ ุงูุฎุงุตุฉ ุจู.

<Callout>
ูู ุงููุซุงู ุฃุนูุงูุ ุนูุฏ ุฅุนุงุฏุฉ ุชุฑููุจ ุงููููู `<App/>`ุ ุณูุชู ุฃูุถุง ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุฒูุฏ. ูุฌุจ ูุถุน ูุฒูุฏู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุฃุนูู ูู ุดุฌุฑุฉ ุงูููููุงุชุ ุฃู ุฎุงุฑุฌ ุงูุนุฑุถ.
</Callout>

import { Cache } from 'components/diagrams/cache'

<div className="my-8">
  <Cache/>
</div>

ุนูุฏ ุงูุชุฏุงุฎูุ ุณุชุณุชุฎุฏู ุฎุทุงูุงุช SWR ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุณุชูู ุงูุฃุนูู. ุฅุฐุง ูู ููู ููุงู ูุฒูุฏ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ูู ุงููุณุชูู ุงูุฃุนููุ ูุฅูู ูุชุฑุงุฌุน ุฅูู ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุงูุชุฑุงุถูุ ููู `Map` ูุงุฑุบ.

<Callout emoji="โ๏ธ">
   ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุชุ ูุฅู `mutate` ุงูุนุงููู **ูุง** ุณูุนูู ุนูู ุฎุทุงูุงุช SWR ุชุญุช ุญุฏูุฏ `<SWRConfig>` ูุฐู. ูุฑุฌู ุงุณุชุฎุฏุงู [this](#access-current-cache-provider) ุจุฏูุง ูู ุฐูู.
</Callout>

## ุงููุตูู ุฅูู ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุญุงูู [#access-current-cache-provider] 

ุนูุฏูุง ุชููู ุฏุงุฎู ูููู Reactุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุฎุทุงู [`useSWRConfig`](/docs/global-configuration#access-to-global-configurations) ูููุตูู ุฅูู ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุญุงูู ุจุงูุฅุถุงูุฉ ุฅูู ุงูุชููููุงุช ุงูุฃุฎุฑู ุจูุง ูู ุฐูู `mutate`:

```jsx
import { useSWRConfig } from 'swr'

function Avatar() {
  const { cache, mutate, ...extraConfig } = useSWRConfig()
  // ...
}
```

ุฅุฐุง ูู ููู ุชุญุช ุฃู  `<SWRConfig>`ุ ูุณูุนูุฏ ุงูุชููููุงุช ุงูุงูุชุฑุงุถูุฉ.

## ุชุฌุฑูุจู: ุชูุฏูุฏ ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช [#experimental-extend-cache-provider]

<Callout emoji="๐งช">
   ูุฐู ููุฒุฉ ุชุฌุฑูุจูุฉุ ูุฏ ูุชุบูุฑ ุงูุณููู ูู ุงูุชุฑููุงุช ุงููุณุชูุจููุฉ.
</Callout>

ุนูุฏูุง ุชููู ููููุงุช `<SWRConfig>` ูุชุนุฏุฏุฉ ูุชุฏุงุฎูุฉุ ูููู ุชูุฏูุฏ ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช. ุฑูู 

ุงููุณูุทุฉ ุงูุฃููู ููุธููุฉ `provider` ูู ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุณุชูู ุงูุฃุนูู `<SWRConfig>` (ุฃู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ููู ููุงู ุงูุฃุตู  `<SWRConfig>`)ุ ููููู ุงุณุชุฎุฏุงูู ูุชูุณูุน ูุฒูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช:

```jsx
<SWRConfig value={{ provider: (cache) => newCache }}>
  ...
</SWRConfig>
```

## ุฃูุซูุฉ [#ุฃูุซูุฉ] 

### LocalStorage Based Persent Cache [#localstorage-based-persistent-cache] 

ูุฏ ุชุฑุบุจ ูู ูุฒุงููุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงูุฎุงุตุฉ ุจู ูุน `localStorage`. ุฅููู ูุซุงู ุนูู ุงูุชูููุฐ:

```jsx
function localStorageProvider() {
  // When initializing, we restore the data from `localStorage` into a map.
  const map = new Map(JSON.parse(localStorage.getItem('app-cache') || '[]'))

  // Before unloading the app, we write back all the data into `localStorage`.
  window.addEventListener('beforeunload', () => {
    const appCache = JSON.stringify(Array.from(map.entries()))
    localStorage.setItem('app-cache', appCache)
  })

  // We still use the map for write & read for performance.
  return map
}
```

ุซู ุงุณุชุฎุฏูู ููุฒูุฏ:

```jsx
<SWRConfig value={{ provider: localStorageProvider }}>
  <App/>
</SWRConfig>
```

<Callout>
  ูุชุญุณููุ ููููู ุฃูุถุง ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุฐุงูุฑุฉ ููุฎุฒู ูุคูุชุ ูุงููุชุงุจุฉ ุฅูู `localStorage` ุจุดูู ุฏูุฑู. ููููู ุฃูุถุง ุชูููุฐ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ูุชุนุฏุฏุฉ ุงูุทุจูุงุช ููุงุซูุฉ ุจุงุณุชุฎุฏุงู IndexedDB ุฃู WebSQL.
</Callout>

### ุฅุนุงุฏุฉ ุชุนููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ [#reset-cache-between-test-cases] 

ุนูุฏ ุงุฎุชุจุงุฑ ุงูุชุทุจูู ุงูุฎุงุต ุจูุ ูุฏ ุชุฑุบุจ ูู ุฅุนุงุฏุฉ ุชุนููู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช SWR ุจูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ. ููููู ุจุจุณุงุทุฉ ูู ุทูุจู ุจูุฒูุฏ ุฐุงูุฑุฉ ุชุฎุฒูู ูุคูุช ูุงุฑุบ. ุฅููู ูุซุงู ูุน Jest:

```jsx
describe('test suite', async () => {
  it('test case', async () => {
    render(
      <SWRConfig value={{ provider: () => new Map() }}>
        <App/>
      </SWRConfig>
    )
  })
})
```

### ุชุนุฏูู ุจูุงูุงุช ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช [#modify-the-cache-data]

<Callout emoji="๐จ" type="error">
ูุฌุจ ุฃูุง ุชูุชุจ ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุจุงุดุฑุฉุ ููุฏ ูุชุณุจุจ ุฐูู ูู ุณููู ุบูุฑ ูุญุฏุฏ.
</Callout>

ููููู ุงุณุชุฎุฏุงู [`mutate`](/docs/mutation) ูุชุนุฏูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช. ุนูู ุณุจูู ุงููุซุงูุ ููููู ูุณุญ ุฌููุน ุจูุงูุงุช ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุซู ูุง ููู.

```jsx
const { mutate } = useSWRConfig()

mutate(
  key => true, // which cache keys are updated
  undefined, // update cache data to `undefined`
  { revalidate: false } // do not revalidate
)
```

ูููู ุงูุนุซูุฑ ุนูู ูุฒูุฏ ูู ุงููุนูููุงุช [ููุง](/docs/arguments#multiple-arguments).
